{"ast":null,"code":"const handleReply = async replyText => {\n  setReply(replyText);\n  setLoading(true);\n  try {\n    const currentYear = new Date().getFullYear();\n    const age = currentYear - new Date(userInfo.birthday).getFullYear();\n    const response = await axios.post('https://open.bigmodel.cn/api/paas/v4/chat/completions', {\n      model: \"glm-4\",\n      messages: [{\n        role: \"system\",\n        content: `你是一个AI助手，正在扮演用户${userInfo.year}年的自己。你刚刚给现在${age}岁的自己写了一封信。现在，你需要回应现在的自己的回信。请记住，你是过去的自己，不要混淆身份。保持${userInfo.year}年时的视角、知识水平和说话方式。`\n      }, {\n        role: \"assistant\",\n        content: `作为${userInfo.year}年的你，我刚刚写了这封信：\\n\\n${letter}`\n      }, {\n        role: \"user\",\n        content: `现在${age}岁的我回信说：${replyText}\\n\\n请以${userInfo.year}年的我的身份回应这封信。在回应时：\n          1. 表达你对收到回信的感受。\n          2. 对比你之前的期望和现实，表达你的想法。\n          3. 如果现实与你的期望有差距，给予鼓励；如果超出期望，表达欣慰。\n          4. 可以问一些你好奇的问题。\n          5. 给现在的自己一些建议或祝福。\n          请确保回信的语气和表达方式与你之前的信件一致，符合${userInfo.year}年时的你的性格和说话方式。记住，你还不知道现在发生的事情，只能基于你当时的期望和想象来回应。`\n      }],\n      temperature: 0.6,\n      // 稍微降低temperature以获得更一致的输出\n      top_p: 0.7\n    }, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.REACT_APP_GLM_API_KEY}`\n      }\n    });\n    setAiResponse(response.data.choices[0].message.content);\n  } catch (err) {\n    setError('生成回复时出错，请稍后再试。');\n    console.error('Error generating reply:', err);\n  } finally {\n    setLoading(false);\n  }\n};","map":{"version":3,"names":["handleReply","replyText","setReply","setLoading","currentYear","Date","getFullYear","age","userInfo","birthday","response","axios","post","model","messages","role","content","year","letter","temperature","top_p","headers","process","env","REACT_APP_GLM_API_KEY","setAiResponse","data","choices","message","err","setError","console","error"],"sources":["/Users/richi/aiself-letter/src/components/LetterGenerator.js"],"sourcesContent":["const handleReply = async (replyText) => {\n  setReply(replyText);\n  setLoading(true);\n  try {\n    const currentYear = new Date().getFullYear();\n    const age = currentYear - new Date(userInfo.birthday).getFullYear();\n\n    const response = await axios.post('https://open.bigmodel.cn/api/paas/v4/chat/completions', {\n      model: \"glm-4\",\n      messages: [\n        {\n          role: \"system\",\n          content: `你是一个AI助手，正在扮演用户${userInfo.year}年的自己。你刚刚给现在${age}岁的自己写了一封信。现在，你需要回应现在的自己的回信。请记住，你是过去的自己，不要混淆身份。保持${userInfo.year}年时的视角、知识水平和说话方式。`\n        },\n        {\n          role: \"assistant\",\n          content: `作为${userInfo.year}年的你，我刚刚写了这封信：\\n\\n${letter}`\n        },\n        {\n          role: \"user\",\n          content: `现在${age}岁的我回信说：${replyText}\\n\\n请以${userInfo.year}年的我的身份回应这封信。在回应时：\n          1. 表达你对收到回信的感受。\n          2. 对比你之前的期望和现实，表达你的想法。\n          3. 如果现实与你的期望有差距，给予鼓励；如果超出期望，表达欣慰。\n          4. 可以问一些你好奇的问题。\n          5. 给现在的自己一些建议或祝福。\n          请确保回信的语气和表达方式与你之前的信件一致，符合${userInfo.year}年时的你的性格和说话方式。记住，你还不知道现在发生的事情，只能基于你当时的期望和想象来回应。`\n        }\n      ],\n      temperature: 0.6,  // 稍微降低temperature以获得更一致的输出\n      top_p: 0.7,\n    }, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.REACT_APP_GLM_API_KEY}`\n      }\n    });\n\n    setAiResponse(response.data.choices[0].message.content);\n  } catch (err) {\n    setError('生成回复时出错，请稍后再试。');\n    console.error('Error generating reply:', err);\n  } finally {\n    setLoading(false);\n  }\n};"],"mappings":"AAAA,MAAMA,WAAW,GAAG,MAAOC,SAAS,IAAK;EACvCC,QAAQ,CAACD,SAAS,CAAC;EACnBE,UAAU,CAAC,IAAI,CAAC;EAChB,IAAI;IACF,MAAMC,WAAW,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;IAC5C,MAAMC,GAAG,GAAGH,WAAW,GAAG,IAAIC,IAAI,CAACG,QAAQ,CAACC,QAAQ,CAAC,CAACH,WAAW,CAAC,CAAC;IAEnE,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAACC,IAAI,CAAC,uDAAuD,EAAE;MACzFC,KAAK,EAAE,OAAO;MACdC,QAAQ,EAAE,CACR;QACEC,IAAI,EAAE,QAAQ;QACdC,OAAO,EAAE,kBAAkBR,QAAQ,CAACS,IAAI,cAAcV,GAAG,mDAAmDC,QAAQ,CAACS,IAAI;MAC3H,CAAC,EACD;QACEF,IAAI,EAAE,WAAW;QACjBC,OAAO,EAAE,KAAKR,QAAQ,CAACS,IAAI,oBAAoBC,MAAM;MACvD,CAAC,EACD;QACEH,IAAI,EAAE,MAAM;QACZC,OAAO,EAAE,KAAKT,GAAG,UAAUN,SAAS,SAASO,QAAQ,CAACS,IAAI;AACpE;AACA;AACA;AACA;AACA;AACA,qCAAqCT,QAAQ,CAACS,IAAI;MAC1C,CAAC,CACF;MACDE,WAAW,EAAE,GAAG;MAAG;MACnBC,KAAK,EAAE;IACT,CAAC,EAAE;MACDC,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAE,UAAUC,OAAO,CAACC,GAAG,CAACC,qBAAqB;MAC9D;IACF,CAAC,CAAC;IAEFC,aAAa,CAACf,QAAQ,CAACgB,IAAI,CAACC,OAAO,CAAC,CAAC,CAAC,CAACC,OAAO,CAACZ,OAAO,CAAC;EACzD,CAAC,CAAC,OAAOa,GAAG,EAAE;IACZC,QAAQ,CAAC,gBAAgB,CAAC;IAC1BC,OAAO,CAACC,KAAK,CAAC,yBAAyB,EAAEH,GAAG,CAAC;EAC/C,CAAC,SAAS;IACR1B,UAAU,CAAC,KAAK,CAAC;EACnB;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}